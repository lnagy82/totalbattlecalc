"use strict";(self.webpackChunktotalbattlecalc=self.webpackChunktotalbattlecalc||[]).push([[768],{768:(H,h,a)=>{a.r(h),a.d(h,{TroopCalculatorModule:()=>M});var u=a(6274),p=a(805),d=a(2889),t=a(2741),g=a(6995);class U{constructor(o,e,n,i){this.leadership=o,this.strength=e,this.health=n,this.battleUnits=i}}let _=(()=>{class r{constructor(){}incrementTroops(e){e[0].number=e[0].number+1}decrementTroops(e,n){for(let i=0;i<e.length;i++)if(e[i]!==n[i]){n[i].number=n[i].number-1;break}}eqTroops(e,n){for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}sumLeadership(e){let n=0;return e.forEach(i=>{n+=i.unit.leadership*i.number}),n}sumCost(e){let n=0;return e.forEach(i=>{n+=i.getAllCost()}),n}sumStrength(e){let n=0;return e.forEach(i=>{n+=this.getAllStrength(i)}),n}sumHealth(e){let n=0;return e.forEach(i=>{n+=this.getAllHealth(i)}),n}getAllStrength(e){return e.unit.strength*e.number*((e.bStrength+100)/100)}getAllHealth(e){return e.unit.health*e.number*((e.bHealth+100)/100)}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),m=(()=>{class r extends _{constructor(){super()}optimizeTroopsHealth(e,n,i){do{this.incrementTroops(e),e.sort((l,s)=>this.getAllHealth(l)-this.getAllHealth(s))}while(i>this.sumLeadership(e));do{this.decrementTroops(e,n),e.sort((l,s)=>this.getAllHealth(l)-this.getAllHealth(s))}while(!this.eqTroops(e,n))}getAllHealth(e){return e.unit.health*e.number*((e.bHealth+100)/100)}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),Z=(()=>{class r{constructor(){}initializePreferredUnits(e){return[...e].sort((i,l)=>l.unit.strength-i.unit.strength)}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),T=(()=>{class r{constructor(e,n){this.healthOptimizerService=e,this.preferredUnitFactoryService=n}getTroopsCalculation(e,n){const i=this.preferredUnitFactoryService.initializePreferredUnits(e);return this.healthOptimizerService.optimizeTroopsHealth(e,i,n),new U(this.healthOptimizerService.sumLeadership(e),this.healthOptimizerService.sumStrength(e),this.healthOptimizerService.sumHealth(e),e)}}return r.\u0275fac=function(e){return new(e||r)(t.LFG(m),t.LFG(Z))},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var b=a(5519),v=a(4243),c=a(3324),f=a(4477);function C(r,o){if(1&r){const e=t.EpF();t.TgZ(0,"a",19),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.oxw().gotoBattle(l)}),t._uU(1,"\n            "),t._UZ(2,"img",20),t._uU(3),t.qZA()}if(2&r){const e=o.$implicit,n=t.oxw();t.xp6(2),t.Q6J("src",n.getUnitAvatarUrl(e),t.LSH),t.xp6(1),t.hij("\n            ",e.name,"\n          ")}}function A(r,o){if(1&r){const e=t.EpF();t.TgZ(0,"tr",27),t._uU(1,"\n              "),t.TgZ(2,"th"),t._uU(3,"\n                "),t._UZ(4,"img",20),t._uU(5,"\n                "),t._UZ(6,"br"),t._uU(7),t.qZA(),t._uU(8,"\n              "),t.TgZ(9,"td"),t._uU(10,"\n                "),t.TgZ(11,"div",5),t._uU(12,"\n                  "),t.TgZ(13,"input",28),t.NdJ("ngModelChange",function(i){return t.CHM(e).$implicit.bHealth=i}),t.qZA(),t._uU(14,"\n                "),t.qZA(),t._uU(15,"\n              "),t.qZA(),t._uU(16,"\n              "),t.TgZ(17,"td"),t._uU(18),t.qZA(),t._uU(19,"\n              "),t.TgZ(20,"td"),t._uU(21),t.ALo(22,"number"),t.qZA(),t._uU(23,"\n              "),t.TgZ(24,"td",29),t._uU(25,"\n                "),t.TgZ(26,"div",30),t._uU(27,"\n                  "),t.TgZ(28,"button",31),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.oxw(2).gotoHome(l)}),t._uU(29,"\n                    "),t._UZ(30,"fa-icon",32),t._uU(31,"\n                    "),t.TgZ(32,"span",33),t._uU(33,"Remove"),t.qZA(),t._uU(34,"\n                  "),t.qZA(),t._uU(35,"\n                "),t.qZA(),t._uU(36,"\n              "),t.qZA(),t._uU(37,"\n            "),t.qZA()}if(2&r){const e=o.$implicit,n=t.oxw(2);t.xp6(4),t.Q6J("src",n.getUnitAvatarUrl(e.unit),t.LSH),t.xp6(3),t.hij("\n                ",e.unit.name,"\n              "),t.xp6(6),t.Q6J("ngModel",e.bHealth),t.xp6(5),t.Oqu(e.number),t.xp6(3),t.Oqu(t.xi3(22,5,n.getAllHealth(e),"1.0-0"))}}function y(r,o){if(1&r&&(t.TgZ(0,"div",21),t._uU(1,"\n        "),t.TgZ(2,"table",22),t._uU(3,"\n          "),t.TgZ(4,"thead"),t._uU(5,"\n            "),t.TgZ(6,"tr"),t._uU(7,"\n              "),t._UZ(8,"th"),t._uU(9,"\n              "),t.TgZ(10,"th"),t._uU(11,"\n                "),t.TgZ(12,"span",23),t._uU(13,"Bonus Health"),t.qZA(),t._uU(14,"\n              "),t.qZA(),t._uU(15,"\n              "),t.TgZ(16,"th"),t._uU(17,"\n                "),t.TgZ(18,"span",24),t._uU(19,"Number"),t.qZA(),t._uU(20,"\n              "),t.qZA(),t._uU(21,"\n              "),t.TgZ(22,"th"),t._uU(23,"\n                "),t.TgZ(24,"span",25),t._uU(25,"Health"),t.qZA(),t._uU(26,"\n              "),t.qZA(),t._uU(27,"\n              "),t._UZ(28,"th"),t._uU(29,"\n            "),t.qZA(),t._uU(30,"\n          "),t.qZA(),t._uU(31,"\n          "),t.TgZ(32,"tbody"),t._uU(33,"\n            "),t.YNc(34,A,38,8,"tr",26),t._uU(35,"\n          "),t.qZA(),t._uU(36,"\n        "),t.qZA(),t._uU(37,"\n      "),t.qZA()),2&r){const e=t.oxw();t.xp6(34),t.Q6J("ngForOf",e.battleUnits)("ngForTrackBy",e.trackId)}}const q=[{path:"",component:(()=>{class r{constructor(e,n,i){this.unitService=e,this.troopCalculatorService=n,this.localStorageService=i,this.battleUnits=[],this.isLoading=!1,this.maxLeadership=28e3,this.bHealth=0}ngOnInit(){this.unitService.query().subscribe(e=>{var n,i;this.isLoading=!1,this.battleUnits=null!==(n=this.localStorageService.retrieve("battleUnits"))&&void 0!==n?n:[],this.possibleUnits=this.localStorageService.retrieve("possibleUnits"),(null==this.possibleUnits||0===this.possibleUnits.length)&&(this.possibleUnits=null!==(i=e.body)&&void 0!==i?i:[],this.sortByName(this.possibleUnits)),this.calculate()},()=>{this.isLoading=!1})}trackId(e,n){return n.id}gotoBattle(e){if(this.selectedUnit||(this.selectedUnit=e),this.selectedUnit){this.battleUnits.push(new d.Z(1,0,564,this.bHealth,this.selectedUnit));const n=this.possibleUnits.indexOf(this.selectedUnit);this.possibleUnits.splice(n,1),this.selectedUnit=void 0,this.saveUnits()}console.log(this.selectedUnit)}gotoHome(e){const n=this.battleUnits.indexOf(e);this.battleUnits.splice(n,1),this.possibleUnits.push(e.unit),this.sortByName(this.possibleUnits),this.saveUnits()}calculate(){this.battleUnits.forEach(n=>{n.number=0});const e=this.troopCalculatorService.getTroopsCalculation(this.battleUnits,this.maxLeadership);this.battleUnits=e.battleUnits,this.leadership=(0,u.uf)(e.leadership,"en","1.0-0"),this.strength=(0,u.uf)(e.strength,"en","1.0-0"),this.health=(0,u.uf)(e.health,"en","1.0-0"),this.saveUnits()}getAllHealth(e){return e.unit.health*e.number*(e.bHealth+100)/100}getUnitAvatarUrl(e){return"../../../content/images/units/"+e.imageUrl}sumLeadership(e){let n=0;return e.forEach(i=>{n+=i.unit.leadership*i.number}),n}saveUnits(){this.localStorageService.store("possibleUnits",this.possibleUnits),this.localStorageService.store("battleUnits",this.battleUnits)}sortByName(e){e.sort(function(n,i){const l=n.tier===i.tier?0:n.tier<i.tier?-1:1,s=n.name.localeCompare(i.name);return l||s})}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(g._),t.Y36(T),t.Y36(b.n2))},r.\u0275cmp=t.Xpm({type:r,selectors:[["jhi-troop-calculator"]],decls:98,vars:7,consts:[[1,"container"],[1,"row"],[1,"col"],["type","button","data-toggle","collapse","data-target","#collapseExample","aria-expanded","false","aria-controls","collapseExample",1,"btn","btn-primary"],["id","collapseExample",1,"collapse"],[1,"form-group"],["jhiTranslate","totalbattlecalcApp.unit.maxLeadership","for","field_leadership",1,"form-control-label"],["type","text","name","leadership","id","field_leadership","data-cy","leadership",1,"form-control",3,"ngModel","ngModelChange"],[1,"col","form-group"],["type","button",1,"btn","btn-primary",3,"click"],["type","button","data-toggle","dropdown","aria-haspopup","true","aria-expanded","false",1,"btn","btn-primary","dropdown-toggle"],[1,"dropdown-menu","vertical-scrollable"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"input-group"],["id","basic-addon1",1,"input-group-text"],["type","text","disabled","",1,"form-control",3,"ngModel","ngModelChange"],["type","text","title","Without bonuses","disabled","",1,"form-control",3,"ngModel","ngModelChange"],["type","text","title","With bonuses","disabled","",1,"form-control",3,"ngModel","ngModelChange"],["class","table-responsive","id","entities",4,"ngIf"],[1,"dropdown-item",3,"click"],["alt","Avatar",1,"profile-image","rounded-circle",3,"src"],["id","entities",1,"table-responsive"],["aria-describedby","page-heading",1,"table","table-striped"],["jhiTranslate","totalbattlecalcApp.battleUnit.bHealth"],["jhiTranslate","totalbattlecalcApp.battleUnit.number"],["jhiTranslate","totalbattlecalcApp.unit.health"],["data-cy","entityTable",4,"ngFor","ngForOf","ngForTrackBy"],["data-cy","entityTable"],["type","number","name","bHealth","id","field_bHealth",1,"form-control",3,"ngModel","ngModelChange"],[1,"text-right"],[1,"btn-group"],["data-cy","entityDetailsButton",1,"btn","btn-danger","btn-sm",3,"click"],["icon","trash-alt"],["jhiTranslate","entity.action.remove",1,"d-none","d-md-inline"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t._uU(1,"\n  "),t.TgZ(2,"div",1),t._uU(3,"\n    "),t.TgZ(4,"div",2),t._uU(5,"\n      "),t.TgZ(6,"p"),t._uU(7,"\n        "),t.TgZ(8,"button",3),t._uU(9,"\n          Setup\n        "),t.qZA(),t._uU(10,"\n      "),t.qZA(),t._uU(11,"\n      "),t.TgZ(12,"div",4),t._uU(13,"\n        "),t.TgZ(14,"div",5),t._uU(15,"\n          "),t.TgZ(16,"label",6),t._uU(17,"Maximum Leadership"),t.qZA(),t._uU(18,"\n          "),t.TgZ(19,"input",7),t.NdJ("ngModelChange",function(l){return n.maxLeadership=l}),t.qZA(),t._uU(20,"\n        "),t.qZA(),t._uU(21,"\n      "),t.qZA(),t._uU(22,"\n    "),t.qZA(),t._uU(23,"\n  "),t.qZA(),t._uU(24,"\n  "),t.TgZ(25,"div",1),t._uU(26,"\n    "),t.TgZ(27,"div",8),t._uU(28,"\n      "),t.TgZ(29,"button",9),t.NdJ("click",function(){return n.calculate()}),t._uU(30,"Calculate"),t.qZA(),t._uU(31,"\n    "),t.qZA(),t._uU(32,"\n  "),t.qZA(),t._uU(33,"\n  "),t.TgZ(34,"div",1),t._uU(35,"\n    "),t.TgZ(36,"div",2),t._uU(37,"\n      "),t.TgZ(38,"div"),t._uU(39,"\n        "),t.TgZ(40,"button",10),t._uU(41,"\n          Select Unit\n        "),t.qZA(),t._uU(42,"\n        "),t.TgZ(43,"div",11),t._uU(44,"\n          "),t.YNc(45,C,4,2,"a",12),t._uU(46,"\n        "),t.qZA(),t._uU(47,"\n      "),t.qZA(),t._uU(48,"\n    "),t.qZA(),t._uU(49,"\n  "),t.qZA(),t._uU(50,"\n  "),t._UZ(51,"br"),t._uU(52,"\n  "),t.TgZ(53,"div",1),t._uU(54,"\n    "),t.TgZ(55,"div",8),t._uU(56,"\n      "),t.TgZ(57,"div",13),t._uU(58,"\n        "),t.TgZ(59,"span",14),t._uU(60,"Leadership"),t.qZA(),t._uU(61,"\n        "),t.TgZ(62,"input",15),t.NdJ("ngModelChange",function(l){return n.leadership=l}),t.qZA(),t._uU(63,"\n      "),t.qZA(),t._uU(64,"\n    "),t.qZA(),t._uU(65,"\n    "),t.TgZ(66,"div",8),t._uU(67,"\n      "),t.TgZ(68,"div",13),t._uU(69,"\n        "),t.TgZ(70,"span",14),t._uU(71,"Strength"),t.qZA(),t._uU(72,"\n        "),t.TgZ(73,"input",16),t.NdJ("ngModelChange",function(l){return n.strength=l}),t.qZA(),t._uU(74,"\n      "),t.qZA(),t._uU(75,"\n    "),t.qZA(),t._uU(76,"\n    "),t.TgZ(77,"div",8),t._uU(78,"\n      "),t.TgZ(79,"div",13),t._uU(80,"\n        "),t.TgZ(81,"span",14),t._uU(82,"Health"),t.qZA(),t._uU(83,"\n        "),t.TgZ(84,"input",17),t.NdJ("ngModelChange",function(l){return n.health=l}),t.qZA(),t._uU(85,"\n      "),t.qZA(),t._uU(86,"\n    "),t.qZA(),t._uU(87,"\n  "),t.qZA(),t._uU(88,"\n  "),t.TgZ(89,"div",1),t._uU(90,"\n    "),t.TgZ(91,"div",2),t._uU(92,"\n      "),t.YNc(93,y,38,2,"div",18),t._uU(94,"\n    "),t.qZA(),t._uU(95,"\n  "),t.qZA(),t._uU(96,"\n"),t.qZA(),t._uU(97,"\n")),2&e&&(t.xp6(19),t.Q6J("ngModel",n.maxLeadership),t.xp6(26),t.Q6J("ngForOf",n.possibleUnits)("ngForTrackBy",n.trackId),t.xp6(17),t.Q6J("ngModel",n.leadership),t.xp6(11),t.Q6J("ngModel",n.strength),t.xp6(11),t.Q6J("ngModel",n.health),t.xp6(9),t.Q6J("ngIf",n.battleUnits&&n.battleUnits.length>0))},directives:[v.P,c.Fj,c.JJ,c.On,u.sg,u.O5,c.wV,f.BN],pipes:[u.JJ],styles:["button[_ngcontent-%COMP%]{min-width:150px}.vertical-scrollable[_ngcontent-%COMP%]{overflow-y:scroll;max-height:80vh}"]}),r})()}];let x=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[p.Bz.forChild(q)],p.Bz]}),r})();var S=a(1382);let M=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[S.m,x,u.ez]]}),r})()}}]);